@using BizLogic.Planning
@using REYMAN.ViewModels
@model NewMaterialViewModel
@{
    Layout = "AdminLayout";
}

<CENTER>
    <div class="main">
        <h1>Añadir material</h1>
        <form method="post">
            <div class="form-group col-md-4 col-md-offset-3">
                <label>Nombre</label>
                <input type="text" asp-for="Nombre" class="form-control" list="data" onkeydown="DeleteName(this.value);" onblur="AddName(this.value);"/>
                @*<input asp-for="Nombre" class="form-control" required />*@
                <span asp-validation-for="Nombre" class="text-danger"></span>
            </div>
            <div class="form-group col-md-4 col-md-offset-3">
                <label>Unidad de medida</label>
                <select asp-for="UnidadDeMedida" class="form-control">
                    @foreach (var item in Model.Unidades)
                    {
                        <option value=@item.Nombre>@item.Nombre</option>
                    }
                </select>
                <span asp-validation-for="UnidadDeMedida" class="text-danger"></span>
            </div>
            <div class="form-group col-md-4">
                <label>Cantidad</label>
                <input asp-for="Cantidad" class="form-control" onkeydown="return int_validate(event, this.value);" oninput="parse(this);" />
                <span asp-validation-for="Cantidad" class="text-danger"></span>
            </div>
            <div class="form-group col-md-4">
                <label>Precio en CUC</label>
                <input asp-for="CUC" class="form-control" onkeydown="return double_validate(event, this.value);" oninput="precision(this, 2);" />
                <span asp-validation-for="CUC" class="text-danger"></span>
            </div>
            <div class="form-group col-md-4 col-md-offset-3">
                <label>Precio en CUP</label>
                <input asp-for="CUP" class="form-control" onkeydown="return double_validate(event, this.value);" oninput="precision(this, 2);" />
                <span asp-validation-for="CUP" class="text-danger"></span>
            </div>
            <button class="button" name="Id" value=@Model.Id>Guardar</button>

            <datalist id="data">
                @foreach (var item in Model._Materiales)
                {
                    <option>@item</option>
                }
            </datalist>

            <datalist id="new_data"></datalist>
        </form>
    </div>
</CENTER>

@section Scripts{
    <script>

        function find_op(val, name) {
            var dl = document.getElementById(name);
            var op = dl.options;
            var ans = -1;
            for (var i = 0; i < op.length; ++i) {
                if (op[i].value === val) {
                    ans = i;
                    break;
                }
            }
            return ans;
        }

        function DeleteName(name) {
            if (name.length === 0) return;
            console.log("delete");
            var dl = document.getElementById("new_data");
            var op = dl.options;
            var rm = false;
            var pos = find_op(name, "new_data");
            if (pos != -1) {
                if (op[pos].id === "1") {
                    op[pos].remove();
                    rm = true;
                }
                else {
                    op[pos].id = parseInt(op[pos].id) - 1;
                }
            }
            if (rm) {
                dl = document.getElementById("data");
                op = dl.options;
                pos = find_op(name, "data");
                op[pos].remove();
            }
            console.log("good by delete");
        }

        function AddName(name) {
            if (name.length === 0) return;
            console.log("add");
            var dl = document.getElementById("data");
            var op = dl.options;
            var pos = find_op(name, "data");
            if (pos !== -1) {
                console.log("ok");
                dl = document.getElementById("new_data");
                op = dl.options;
                pos = find_op(name, "new_data");
                if (pos !== -1) {
                    op[pos].id = parseInt(op[pos].id) + 1;
                }
            }
            else {
                op = document.createElement("option");
                op.innerHTML = name;
                dl.appendChild(op);
                op = document.createElement("option");
                op.innerHTML = name;
                op.id = 1;
                dl = document.getElementById("new_data");
                dl.appendChild(op);
            }
            console.log("good by add");
        }

    </script>
}
